# Building

KeybindLib depends on several proprietary assemblies that are part of Slime Rancher, several of which need to be publicized. This makes the build process a little complicated.

If you just want a bleeding-edge version of KeybindLib, you can download one from [GitHub Actions](https://github.com/Esper89/SlimeRancher-KeybindLib/actions). Otherwise, follow the steps below.

## Windows

 - Download the repository.

 - Go to your Slime Rancher installation and copy the contents of `SlimeRancher_Data\Managed` to the repository's `build\build-depends` folder.

 - Go back to your Slime Rancher installation and copy the contents of `SRML\Libs` to the repository's `build\build-depends` folder.

 - Right-click `build\publicizer.sh` and open it in Notepad or another text editor.

 - Go to the `build\build-depends` folder and open it in Command Prompt.

 - For every `publicize <filename>` that you see in `build\publicizer.sh`, type this command:
```cmd
..\AssemblyPublicizer\AssemblyPublicizer.exe <filename>
```

 - Open the folder `src`, then open `KeybindLib.sln` in Visual Studio or another C# IDE.

 - Switch the build configuration from `Testing` to `Release` and build the solution.

 - Open `build\target` in the repository.

 Enjoy your homemade copy of KeybindLib!

 #### For Debugging

 - Create a new file in `build` called `mods-dir.`. Putting the `.` on the end will make sure it's actually called `mods-dir` and not `mods-dir.txt`.

 - Right-click `build\mods-dir` and open it in Notepad or another text editor.

 - Type the location of your SRML Mods folder into this file, and save it. For example:
 ```
 C:\Program Files (x86)\Steam\steamapps\common\Slime Rancher\SRML\Mods
 ```

You can now compile KeybindLib in the `Debug` configuration.

## Linux

First, make sure you have Mono, MonoDevelop, git, and NuGet installed. If you don't, run these commands:
```sh
sudo apt install -y apt-transport-https dirmngr
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
echo "deb https://download.mono-project.com/repo/ubuntu vs-bionic main" | sudo tee /etc/apt/sources.list.d/mono-official-vs.list
sudo apt update
sudo apt install -y git mono-complete monodevelop nuget
```

Then, clone the repo:
```sh
git clone https://github.com/Esper89/SlimeRancher-KeybindLib.git
cd SlimeRancher-KeybindLib
```

Run the autosetup script, giving it the path to your Slime Rancher installation. For example:
```sh
build/autosetup.sh ~/.steam/steamapps/common/Slime Rancher
```

Then, you can build the actual project:
```sh
build/build.sh
```

And the result will be in `build/target`!

You can open the solution file (`src/KeybindLib.sln`) in MonoDevelop, but the error highlighting might not be correct, as MonoDevelop doesn't support C# 8. For an IDE that does support C# 8, you can use [DotDevelop](https://github.com/dotdevelop/dotdevelop).

## Configurations

KeybindLib has three configurations:

 - `Debug`: KeybindLib and ExampleMod are both compiled, and are automatically copied to your Slime Rancher install directory. Debugging symbols are embedded. Requires additional setup on Windows.
 
 - `Release`: KeybindLib is compiled, ExampleMod isn't. KeybindLib's output is placed in `build/target`, along with it's XML documentation and a `.zip` of ExampleMod. Warnings are errors, optimizations are enabled, debugging symbols are not included.

 - `Testing`: Same as `Release`, but ExampleMod *is* compiled, and no ouput is placed in `build/target`.

 Running the `Clean` task on `Debug` or `Release` mode will delete the files that were generated by the corresponding `Build` task.
